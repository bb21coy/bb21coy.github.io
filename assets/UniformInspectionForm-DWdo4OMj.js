import{r as o,j as t,R as I}from"./index-D47I_7n0.js";import{a as d}from"./index-NIGUFBhG.js";import{h as x}from"./handleServerError-BHmHb0ds.js";const A=()=>{const[C,_]=o.useState([]),[h,b]=o.useState([]),[m,S]=o.useState([]),[y,k]=o.useState({}),[r,j]=o.useState({}),[c,g]=o.useState(),[f,v]=o.useState(!1),[u,w]=o.useState({});d.post("/application/0/check_session",{},{withCredentials:!0}).then(e=>{e.data.user?.account_type=="Boy"&&(window.location.href="/home")}).catch(()=>{window.location.href="/"}),o.useEffect(()=>{d.post("/api/uniform_inspection/0/get_component_fields",{},{withCredentials:!0}).then(e=>{S(e.data.components),k(e.data)}).catch(e=>console.error(e)),d.post("/api/account/0/get_accounts_by_type",{account_type:"Boy"},{withCredentials:!0}).then(e=>_(e.data)).catch(e=>x(e.response.status))},[]);function E(){let e=document.querySelectorAll(".boy-account-selector:checked"),s=Array.from(e,n=>n.id);j(n=>{let i={...n};return s.forEach(l=>{i[l]||(i[l]=Object.fromEntries(m.map(a=>[a.id,Object.fromEntries(y[a.component_name].map(p=>[p.id,!1]))])))}),i}),d.post("/api/account/0/get_accounts_by_ids",{boy_ids:s},{withCredentials:!0}).then(n=>{b(n.data),g(n.data[0].id);for(let i in m){let l=document.getElementsByClassName(i+"-field-selector");for(let a of l)a.checked=r[n.data[0].id][i][a.id]}}).catch(n=>x(n.response?.status))}function F(e){let s=document.getElementsByClassName(e.target.name+"-field-selector"),n={};for(let i of s)n[i.id.split("-")[0]]=i.checked;r[c][e.target.name]=n,j(r)}function N(e){const s=e.target.value;g(s),r[s]&&m.forEach(n=>{const i=document.getElementsByClassName(`${n.id}-field-selector`);Array.from(i).forEach(a=>{const p=a.id.split("-")[0];a.checked=r[s]?.[n.id]?.[p]??!1});const l=document.getElementsByTagName("textarea");Array.from(l).forEach(a=>{a.value=r[s]?.[n.id]?.remark??""})})}function B(e){if(e.preventDefault(),!window.confirm("Are you sure you have finished inspecting? Ensure that all boys selected have been inspected before submission."))return;let n={};const l=new Date().toLocaleDateString("en-GB");h.map(a=>{n[a.id]=r[a.id]}),d.post("/api/uniform_inspection/0/create_uniform_inspection",{selectedContents:n,date:l,boys:h,remarks:u},{withCredentials:!0}).then(()=>{window.location.href="/uniform_inspection_results"}).catch(a=>x(a.response?.status))}return t.jsxs("div",{className:"uniform-inspection-form",children:[t.jsxs("div",{className:"form-selection",children:[t.jsx("label",{htmlFor:"boy-selector",children:"Inspecting:"}),t.jsxs("select",{id:"boy-selector",onChange:e=>N(e),value:c||"",children:[t.jsx("option",{value:"",disabled:!0,children:"Select a boy"}),h.map(e=>t.jsxs("option",{value:e.id,children:[e.rank," ",e.account_name]},e.id))]})]}),t.jsxs("div",{className:"page-container",children:[t.jsx("h2",{children:"Uniform Inspection"}),t.jsxs("div",{children:[t.jsx("p",{children:"Pick the boys to inspect:"}),t.jsx("i",{className:"fa-solid fa-chevron-right",onClick:()=>v(!f),style:{transform:f?"rotate(0deg)":"rotate(90deg)"}})]}),t.jsx("div",{className:"boy-selector",style:{height:f?0:"max-content"},children:C.map(e=>t.jsxs(I.Fragment,{children:[t.jsx("input",{type:"checkbox",className:"boy-account-selector",id:e.id,onChange:E}),t.jsx("label",{htmlFor:e.id,children:t.jsxs("p",{children:["Sec ",e.level," ",e.rank," ",e.account_name]})})]},e.id))}),t.jsxs("form",{onSubmit:B,children:[c!=null&&m.map(e=>t.jsxs("div",{children:[t.jsx("h3",{children:e.component_name}),t.jsx("ul",{children:y[e.component_name].map(s=>t.jsxs("li",{children:[t.jsx("input",{type:"checkbox",className:`${e.id}-field-selector ${s.description.toLowerCase().includes("missing")?"field-missing":""}`,id:`${s.id}-field`,name:e.id,onChange:F,defaultChecked:r[c][e.id][s.id]}),t.jsx("label",{htmlFor:`${s.id}-field`,children:s.description})]},s.id))}),t.jsx("textarea",{name:`${e.component_name}-remarks`,placeholder:"Remarks (Optional)",value:u[c]?.[e.id],onChange:s=>w({...u,[c]:{...u[c],[e.id]:s.target.value}})})]},e.id)),t.jsx("button",{children:"Finish Inspection"})]})]})]})};export{A as UniformInspectionForm};
