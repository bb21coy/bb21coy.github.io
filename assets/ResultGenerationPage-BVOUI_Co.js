import{r,j as e}from"./index-D47I_7n0.js";import{a as l}from"./index-NIGUFBhG.js";import{h as d}from"./handleServerError-BHmHb0ds.js";const L=()=>{const[y,S]=r.useState([]),[C,B]=r.useState([]),[c,j]=r.useState(),[o,_]=r.useState(),[N,k]=r.useState([]),[I,D]=r.useState([]),[E,f]=r.useState([]),[R,g]=r.useState(!1),[P,p]=r.useState(),[x,F]=r.useState([]),[u,b]=r.useState([]),[H,m]=r.useState(),[q,w]=r.useState({});l.post("/application/0/check_session",{},{withCredentials:!0}).then(t=>{t.data.user?.account_type=="Boy"&&t.data.user?.appointment==null&&(window.location.href="/home")}).catch(()=>{window.location.href="/"}),r.useEffect(()=>{l.post("/api/award/0/get_awards",{},{withCredentials:!0}).then(t=>{S(t.data.awards),B(t.data.masteries),j(t.data.awards[0])}).catch(t=>d(t.response.status)),l.post("/api/account/0/get_accounts_by_type",{account_type:"Boy"},{withCredentials:!0}).then(t=>{k(t.data)}).catch(t=>d(t.response.status)),l.post("/api/account/0/get_accounts_by_type",{account_type:"Primer"},{withCredentials:!0}).then(t=>{D(t.data);let s=!0;t.data.length>0&&(p(t.data[0].id),s=!1),l.post("/api/account/0/get_accounts_by_type",{account_type:"Officer"},{withCredentials:!0}).then(a=>{f(a.data),s==!0&&p(a.data[0].id)}).catch(()=>f([]))}).catch(t=>d(t.response.status))},[]);function G(t){let s=t.target.value.split(" ");m(),w({}),l.post("/api/award/"+s[0]+"/get_award",{id:s[0]},{withCredentials:!0}).then(a=>{j(a.data),m(a.data.results_description),a.data.has_mastery?l.post("/api/award/"+s[0]+"/get_masteries",{award_id:s[0]},{withCredentials:!0}).then(n=>{_(n.data[parseInt(s[1])-1]);let i=document.getElementsByClassName("result-description");for(let h of i)h.value=n.data[parseInt(s[1])-1].results_description;m(n.data[parseInt(s[1])-1].results_description),l.post("/api/mastery/"+n.data[parseInt(s[1])-1].id+"/get_columns",{id:n.data[parseInt(s[1])-1].id},{withCredentials:!0}).then(h=>b(h.data)).catch(h=>d(h.response.status))}).catch(n=>d(n.response.status)):(_(),document.getElementsByClassName("result-description").map(i=>{i.value=a.data.results_description}),l.post("/api/award/"+a.data.id+"/get_columns",{id:a.data.id},{withCredentials:!0}).then(i=>b(i.data)).catch(i=>d(i.response.status)))}).catch(a=>d(a.response.status))}function O(t){p(t.target.value)}function M(){let t=document.getElementsByClassName("boy-account-selector"),s=[];for(let a of t)a.checked&&s.push(a.id);l.post("/api/account/0/get_accounts_by_ids",{boy_ids:s},{withCredentials:!0}).then(a=>{F(a.data)}).catch(a=>d(a.response.status))}function v(t){t.preventDefault(),m(t.target.value)}function V(t){if(t.preventDefault(),P==null)alert("Results cannot be generated without any Primers or Officers.");else{let s=1,a={};u.map(n=>{a[n.column_title]=[]}),x.map(()=>{u.map(n=>{t.target[s]!=null&&t.target[s].value!=""&&a[n.column_title].push(t.target[s].value),s+=1})}),w(a),g(!0)}}function $(t){t.preventDefault(),g(!1)}return e.jsx("div",{className:"result-generation-page",children:e.jsx("div",{className:"page-container",children:e.jsxs("div",{className:"main-block",children:[e.jsxs("div",{className:"fields generate-results-form",children:[e.jsx("h1",{children:"Generate Results"}),e.jsx("label",{htmlFor:"results-badge",children:"Select a badge to view results:"}),e.jsx("select",{onChange:G,id:"results-badge",children:y.map((t,s)=>{if(!t.has_mastery&&t.has_results)return e.jsx("option",{value:String(t.id)+" 0",children:t.badge_name},t.id+"-award");{let a=[];return C[s].map((n,i)=>{n.has_results&&a.push(e.jsxs("option",{value:String(t.id)+" "+String(i+1),children:[t.badge_name," ",n.mastery_name]},`${t.id}-mastery-${i+1}`))}),a}})}),e.jsx("label",{htmlFor:"results-instructor",children:"Select the instructor for the badgework:"}),e.jsxs("select",{onChange:O,id:"results-instructor",children:[I.map(t=>e.jsxs("option",{value:t.id,children:[t.rank," ",t.account_name]},t.id+"-primer-instructor")),E.map(t=>e.jsxs("option",{value:t.id,children:[t.rank," ",t.account_name]},t.id+"-officer-instructor"))]}),e.jsx("p",{children:"Select the Boys to include in the results:"}),e.jsx("div",{className:"boy-accounts",children:N.map(t=>e.jsxs("div",{className:"account-display",children:[e.jsx("input",{type:"checkbox",className:"boy-account-selector",id:t.id,onChange:M}),e.jsx("label",{htmlFor:t.id,children:e.jsxs("span",{children:["Sec ",t.level," ",t.rank," ",t.account_name]})})]},t.id+"-display"))})]}),e.jsxs("form",{className:"fields",onSubmit:V,children:[c!=null&&o==null&&c.custom_description&&e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("label",{children:"Description of badgework:"}),e.jsx("br",{}),e.jsx("label",{children:c.description_cue}),e.jsx("br",{}),e.jsx("textarea",{className:"result-description",onBlur:v,defaultValue:c.results_description}),e.jsx("br",{})]}),c!=null&&o==null&&c.has_custom_columns&&e.jsxs("div",{children:[e.jsx("label",{children:"Fields of custom columns:"}),e.jsx("br",{}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),u.map(t=>e.jsx("th",{children:t.column_title},t.id+"-column"))]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{children:[e.jsxs("th",{children:["Sec ",t.level," ",t.rank," ",t.account_name]}),u.map(s=>e.jsx("th",{children:e.jsx("input",{id:s.column_title})},s.id+"-row-column"))]},t.id+"-row"))})]})]}),c!=null&&o!=null&&o.custom_description&&e.jsxs("div",{children:[e.jsx("br",{}),e.jsx("label",{children:"Description of badgework:"}),e.jsx("br",{}),e.jsx("label",{children:o.description_cue}),e.jsx("br",{}),e.jsx("textarea",{className:"result-description",onBlur:v,defaultValue:o.results_description}),e.jsx("br",{})]}),c!=null&&o!=null&&o.has_custom_columns&&e.jsxs("div",{children:[e.jsx("label",{children:"Fields of custom columns:"}),e.jsx("br",{}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),u.map(t=>e.jsx("th",{children:t.column_title},t.id+"-column"))]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{children:[e.jsxs("th",{children:["Sec ",t.level," ",t.rank," ",t.account_name]}),u.map(s=>e.jsx("th",{children:e.jsx("input",{id:s.column_title})},s.id+"-row-column"))]},t.id+"-row"))})]})]}),e.jsx("button",{children:"Generate Results"})]}),R&&e.jsx("button",{onClick:$,children:"Hide Results"})]})})})};export{L as ResultGenerationPage};
