import{r as c,j as e,R as N}from"./index-CmEGY9Xn.js";import{a as u}from"./index-NIGUFBhG.js";import{h as x}from"./handleServerError-BHmHb0ds.js";import{P as D}from"./index-Co4oEsvj.js";import{B as f}from"./Constants-B3OfrIZX.js";/* empty css                */const y=["createdAt","updatedAt","__v"],_=({table_name:d})=>{const[g,m]=c.useState([]),[h,l]=c.useState([]);return c.useEffect(()=>{const a=async()=>{try{const r=await u.get(`${f}/admin?table_name=${d}`,{headers:{"x-route":"/get_table"},withCredentials:!0}),i=r.data,t=new Set;i.forEach(n=>{Object.keys(n).forEach(o=>t.add(o))}),console.log(r.data),m(i),l([...t])}catch(r){console.error(r),x(r?.response?.status)}};d!=null&&typeof d=="string"&&a()},[d]),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsx("tr",{children:h.filter(a=>!y.includes(a)).map((a,r)=>e.jsx("th",{children:a},a+r))})}),e.jsx("tbody",{children:g.map((a,r)=>e.jsx("tr",{children:h.filter(i=>!y.includes(i)).map(i=>e.jsx("td",{title:a[i]!==null?String(a[i]):"-",children:a[i]!=null&&a[i]!==""?String(a[i]):"-"},i+r))},a._id))})]})};_.propTypes={table_name:D.string};var C={};const L=()=>{const[d,g]=c.useState([]),[m,h]=c.useState([]),[l,a]=c.useState([]),[r,i]=c.useState(60);return c.useEffect(()=>{(async()=>{try{const o=await u.get("https://api.github.com/repos/bb21coy/bb21coy.github.io/commits?per_page=5&sha=master",{headers:{authorization:C.GITHUB_TOKEN}}),j=await u.get("https://api.github.com/repos/bb21coy/bb-website-v3/commits?per_page=5&sha=main",{headers:{authorization:C.GITHUB_TOKEN}}),p=await u.get(`${f}/admin`,{headers:{"x-route":"/vercel_usage"},withCredentials:!0});console.log(p.data),a(p.data);const v=o.data.map(s=>({commit:s.commit,committer:s.committer}));g(v);const b=j.data.map(s=>({commit:s.commit,committer:s.committer}));h(b)}catch(o){console.error(o),x(o?.response?.status)}})();const n=setInterval(()=>{i(o=>o-1)},1e3);return()=>clearInterval(n)},[]),c.useEffect(()=>{r===0&&(u.get(`${f}/admin`,{headers:{"x-route":"/vercel_usage"},withCredentials:!0}).then(t=>a(t.data)).catch(t=>{console.error(t),x(t?.response?.status)}),i(60))},[r]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"vercel-usage-header",children:[e.jsx("h3",{className:"commit-title",children:"Vercel Usage"}),e.jsx("span",{className:"vercel-timer",style:{background:`conic-gradient(#ff5733 0deg ${r/60*360}deg, #ccc ${r/60*360}deg 360deg)`}})]}),e.jsx("div",{className:"vercel-usage",children:l.map((t,n)=>e.jsxs("div",{className:"vercel",children:[e.jsx("p",{children:t.title}),e.jsxs("div",{children:[e.jsx("span",{className:"ring",style:{background:`conic-gradient(#ff5733 0deg ${t.value/t.limit*360}deg, #ccc ${t.value/t.limit*360}deg 360deg)`}}),e.jsxs("div",{children:[e.jsxs("p",{children:[t.value,"/",t.limit]}),e.jsxs("p",{children:[(t.value/t.limit*100).toFixed(2),"%"]})]})]})]},n))}),e.jsx("h3",{className:"commit-title",children:"Frontend Commits"}),d.map((t,n)=>e.jsxs("div",{className:"commit",children:[e.jsxs("div",{children:[e.jsx("p",{children:t.commit.message}),e.jsx("p",{children:new Date(t.commit.author.date).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("img",{src:t.committer.avatar_url,alt:"Committer Avatar"}),e.jsx("p",{children:t.commit.author.name})]})]},n)),e.jsx("h3",{className:"commit-title",children:"Backend Commits"}),m.map((t,n)=>e.jsxs("div",{className:"commit",children:[e.jsxs("div",{children:[e.jsx("p",{children:t.commit.message}),e.jsx("p",{children:new Date(t.commit.author.date).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("img",{src:t.committer.avatar_url,alt:"Committer Avatar"}),e.jsx("p",{children:t.commit.author.name})]})]},n))]})},R=()=>{const[d,g]=c.useState([]),[m,h]=c.useState(),l=c.useRef(null),[a,r]=c.useState(!1),[i,t]=c.useState(0),[n,o]=c.useState(0);c.useEffect(()=>{u.get(`${f}/admin`,{headers:{"x-route":"/get_table_names"},withCredentials:!0}).then(s=>{g(s.data),h(s.data[0])}).catch(s=>x(s.response.status))},[]);const j=s=>{r(!0),t(s.clientX-l.current.offsetLeft),o(l.current.scrollLeft)},p=()=>{r(!1)},v=()=>{r(!1)},b=s=>{if(!a)return;s.preventDefault();const S=s.clientX-l.current.offsetLeft,E=i-S+n;l.current.scrollLeft=E};return e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{className:"admin-tables-list",children:e.jsxs("div",{children:[e.jsx("input",{type:"radio",onChange:s=>h("usage"),id:"db-radio-usage",name:"tables"}),e.jsx("label",{htmlFor:"db-radio-usage",children:e.jsx("p",{children:"Usage"})}),d.map(s=>e.jsxs(N.Fragment,{children:[e.jsx("input",{type:"radio",onChange:S=>h(s.name),id:`db-radio-${s.info.uuid}`,name:"tables"}),e.jsx("label",{htmlFor:`db-radio-${s.info.uuid}`,children:e.jsx("p",{children:s.name})})]},s.info.uuid))]})}),e.jsxs("div",{className:"page-container",ref:l,onMouseDown:j,onMouseLeave:p,onMouseUp:v,onMouseMove:b,style:{cursor:a?"grabbing":"grab"},children:[m&&m!=="usage"&&e.jsx(_,{table_name:m}),m==="usage"&&e.jsx(L,{})]})]})};export{R as AdminPage};
