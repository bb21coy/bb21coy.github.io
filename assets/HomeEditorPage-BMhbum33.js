import{r as m,j as e,R as S}from"./index-D47I_7n0.js";import{a as l}from"./index-NIGUFBhG.js";import{h as c}from"./handleServerError-BHmHb0ds.js";function _(){const[o,g]=m.useState([]),[x,r]=m.useState([]);m.useEffect(()=>{l.post("/application/0/check_session",{},{withCredentials:!0}).then(t=>{t.data.user?.account_type=="Boy"&&t.data.user?.appointment==null&&(window.location.href="/home")}).catch(()=>window.location.href="/")},[]),m.useEffect(()=>{l.get("/api/home_editor/0/all_testimonies",{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(n=>g(n.data)).catch(n=>c(n.response.status)),l.get("/api/home_editor/0/all_achievements",{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(n=>r(n.data)).catch(n=>c(n.response.status));const t=n=>{if(n.target.tagName==="BUTTON"&&n.target.textContent.trim().toLowerCase()==="delete"){const i=n.target.parentElement.getAttribute("data-id");if(!i){n.target.parentElement.remove();return}l.post("/api/home_editor/0/delete_testimony",{testimony_id:i},{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(s=>{s.data!=!1&&(alert("Testimony deleted"),n.target.parentElement.remove())}).catch(s=>{console.error(s),c(s.response.status)})}else if(n.target.classList.contains("fa-trash")){const i=n.target.parentElement.getAttribute("data-id");if(!i){n.target.parentElement.remove();return}l.post("/api/home_editor/0/delete_achievement",{achievement_id:i},{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(s=>{s.data!=!1&&(alert("Achievement deleted"),n.target.parentElement.remove())}).catch(s=>{console.error(s),c(s.response.status)})}};document.addEventListener("click",t)},[]);const C=(t,n)=>{const i=document.querySelector(`.${t}`);if(!i)return;const s=i.cloneNode(!0);Array.from(s.querySelectorAll("input, textarea")).map(f=>f.value=""),s.removeAttribute("data-id"),document.getElementById(n).appendChild(s)},b=t=>{t.preventDefault();const n=[];if(!t.target.checkValidity())return alert("One or more fields in the Testimony Form is invalid");Array.from(t.target.getElementsByClassName("testimonial-editor")).map(i=>{const s=i.getAttribute("data-id"),[f,v]=Array.from(i.getElementsByTagName("input")).map(a=>a.value),T=i.querySelector("textarea").value;n.push({id:s,date:f,name:v,content:T})}),l.put("/api/home_editor/0/update_testimonies",n,{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(i=>{i.data!=!1&&alert("Testimonies updated")}).catch(i=>{console.error(i),c(i.response.status)})},w=t=>{t.preventDefault();const n=[];if(!t.target.checkValidity())return alert("One or more fields in the Achievement Form is invalid");Array.from(t.target.getElementsByClassName("achievement-editor")).map(i=>{const s=i.getAttribute("data-id"),[f,v]=Array.from(i.getElementsByTagName("input")).map(T=>T.value);n.push({id:s,date:f,achievement:v})}),l.put("/api/home_editor/0/update_achievements",n,{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(i=>{i.data!=!1&&alert("Achievements updated")}).catch(i=>{console.error(i),c(i.response.status)})};return e.jsxs(S.Fragment,{children:[e.jsxs("form",{id:"achievement-container",onSubmit:w,noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Yearly Achievement(s)"}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>C("achievement-editor","achievement-container"),children:[e.jsx("i",{className:"fa-solid fa-plus"})," New"]}),e.jsxs("button",{type:"submit",children:[e.jsx("i",{className:"fa-solid fa-save"})," Save"]})]})]}),x.map(t=>e.jsxs("div",{className:"achievement-editor","data-id":t.id,children:[e.jsx("input",{type:"number",name:"year",placeholder:"Enter Year",defaultValue:t.year,max:new Date().getFullYear(),min:"1984",required:!0}),e.jsx("input",{type:"text",placeholder:"Enter Achievement",name:"achievement",required:!0,defaultValue:t.achievement}),e.jsx("i",{className:"fa-solid fa-trash"})]},t.id))]}),e.jsxs("form",{id:"testimonial-container",onSubmit:b,noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Testimonials"}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>C("testimonial-editor","testimonial-container"),children:[e.jsx("i",{className:"fa-solid fa-plus"})," New"]}),e.jsxs("button",{type:"submit",children:[e.jsx("i",{className:"fa-solid fa-save"})," Save"]})]})]}),o.map(t=>e.jsxs("div",{className:"testimonial-editor","data-id":t.id,children:[e.jsx("label",{htmlFor:`date-${t.id}`,children:"Date:"}),e.jsx("input",{type:"date",id:`date-${t.id}`,name:"year",min:"1990-01-01",max:new Date().toISOString().split("T")[0],defaultValue:t.date.split("T")[0],required:!0}),e.jsx("label",{htmlFor:`name-${t.id}`,children:"Name:"}),e.jsx("input",{type:"text",id:`name-${t.id}`,placeholder:"Enter Name",required:!0,autoComplete:"off",defaultValue:t.name}),e.jsx("label",{htmlFor:`content-${t.id}`,children:"Testimony:"}),e.jsx("textarea",{id:`content-${t.id}`,placeholder:"Enter Testimony",defaultValue:t.testimony}),e.jsxs("button",{type:"button",children:[e.jsx("i",{className:"fa-solid fa-trash"})," Delete"]})]},t.id))]}),e.jsx("template",{children:e.jsxs("div",{className:"testimonial-editor",children:[e.jsx("label",{htmlFor:"date",children:"Date:"}),e.jsx("input",{type:"date",id:"date",name:"year",min:"1984-01-01",max:new Date().toISOString().split("T")[0],defaultValue:new Date().toISOString().split("T")[0],required:!0}),e.jsx("label",{htmlFor:"name",children:"Name:"}),e.jsx("input",{type:"text",id:"name",placeholder:"Enter Name",required:!0,autoComplete:"off"}),e.jsx("label",{htmlFor:"testimony-text",children:"Testimony:"}),e.jsx("textarea",{id:"testimony-text",placeholder:"Enter Testimony"}),e.jsxs("button",{type:"button",children:[e.jsx("i",{className:"fa-solid fa-trash"})," Delete"]})]})}),e.jsx("template",{children:e.jsxs("div",{className:"achievement-editor",children:[e.jsx("input",{type:"number",name:"year",placeholder:"Enter Year",defaultValue:new Date().getFullYear(),max:new Date().getFullYear(),min:"1984",required:!0}),e.jsx("input",{type:"text",placeholder:"Enter Achievement",name:"achievement",required:!0}),e.jsx("i",{className:"fa-solid fa-trash"})]})})]})}function I(){const[o,g]=m.useState([]),[x,r]=m.useState(null),[C,b]=m.useState(!1);m.useEffect(()=>{l.get("/api/home_editor/0/show_images",{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(a=>g(a.data)).catch(a=>c(a.response.status))},[]);const w=a=>{r(a.target.id),a.target.style.opacity="0.5",a.type==="touchstart"&&b(!0)},t=a=>{a.target.style.opacity="1",r(null)},n=a=>{a.preventDefault()},i=a=>{a.preventDefault();const h=x,p=a.target.id;if(p!=="delete"&&h!==p){const d=o.find(u=>u.id==h),j=o.find(u=>u.id==p),y=[...o],E=o.indexOf(d),D=o.indexOf(j);y[E]=j,y[D]=d,g(y);const N=y.map(u=>({id:u.id,order:u.order}));l.put("/api/home_editor/0/update_image",N,{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(u=>{if(u.data==!1)throw new Error("Failed to update images")}).catch(u=>c(u.response.status))}else h&&p=="delete"&&l.post("/api/home_editor/0/delete_image",{image_id:h},{headers:{"Content-Type":"application/json"},withCredentials:!0}).then(d=>{if(d.data!=!1){const j=o.filter(y=>y.id!=h);g(j)}}).catch(d=>c(d.response.status))},s=a=>{const h=a.target.files[0],p=new FormData;p.append("file",h),l.post("/api/home_editor/0/upload_image",p,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}).then(d=>{const j=[...o,d.data];g(j),alert("Image uploaded.")}).catch(d=>c(d.response.status))},f=a=>{b(!0),w(a)},v=a=>{if(C){const h=a.target.getBoundingClientRect(),p=a.touches[0].clientX-h.width/2,d=a.touches[0].clientY-h.height/2;a.target.style.left=`${p}px`,a.target.style.top=`${d}px`}},T=a=>{t(a)};return e.jsxs("div",{className:"home-editor-images",children:[e.jsx("div",{children:o.map(a=>e.jsx("img",{id:a?.id,src:`data:image/webp;base64,${a?.image}`,alt:`Image ${a?.id}`,onDragStart:w,onDragEnd:t,onDragOver:n,draggable:"true",onDrop:i,tabIndex:0,onTouchStart:f,onTouchMove:v,onTouchEnd:T},a?.id))}),e.jsxs("div",{children:[e.jsx("h3",{children:"Upload Image"}),e.jsx("h3",{children:"Delete Image"}),e.jsx("label",{htmlFor:"file",children:"Drag and Drop or Click to upload"}),e.jsx("input",{type:"file",id:"file",accept:"image/webp image/png image/jpeg image/jpg",onChange:s}),e.jsx("div",{id:"delete",onDragOver:n,onDrop:i,children:"Drag and Drop to delete"})]})]})}function q(){const[,o]=m.useState({}),[g,x]=m.useState("text");return m.useEffect(()=>{l.post("/application/0/check_session",{},{withCredentials:!0}).then(r=>{r.data.user?.account_type!="Officer"&&!r.data.user?.appointment.toLowerCase().includes("tech")&&(window.location.href="/home"),o(r.data.user)}).catch(r=>c(r.status))},[]),e.jsxs("div",{className:"home-editor",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Home Page Editor"}),e.jsxs("div",{className:"editor-toggle",children:[e.jsx("input",{type:"radio",name:"toggle",id:"text",defaultChecked:!0,onChange:r=>x(r.target.id)}),e.jsx("label",{htmlFor:"text",children:"Text"}),e.jsx("input",{type:"radio",name:"toggle",id:"image",onChange:r=>x(r.target.id)}),e.jsx("label",{htmlFor:"image",children:"Images"})]})]}),g=="text"?e.jsx(_,{}):e.jsx(I,{})]})}export{q as HomeEditorPage};
